<% valuation = local_assigns.fetch(:valuation, false) %>
<% cache [locale_and_user_status, parent_id, commentable_cache_key(commentable), valuation] do %>
  <% css_id = parent_or_commentable_dom_id(parent_id, commentable) %>
  <div id="js-comment-form-<%= css_id %>" <%= raw("style='display:none'") if toggeable %> class="comment-form">
    <%= form_for Comment.new, remote: true do |f| %>
      <% if commentable.class == Legislation::Question && parent_id == nil %>
        <%= f.label :body, leave_comment_text(commentable), class: "comment-form-label" %>

        <%= f.check_box :terms_of_service,
                        id: "terms_of_service_#{css_id}",
                        title: t("legislation.questions.comments.form.guidelines"),
                        label: t("legislation.questions.comments.form.guidelines") %>

        <%= f.label :subject, t("legislation.questions.comments.form.headline") %>
        <br>

        <div class="input-group">
          <span class="input-group-label">
            <%= @question.title.split(" ").second %>
          </span>
          <%= f.text_field :subject,
                           id: "comment_headline_#{css_id}",
                           label: false,
                           maxlength: 60,
                           placeholder: t("legislation.questions.comments.form.headline_placeholder") %>
        </div>

        <%= f.text_area :body,
                        id: "comment-body-#{css_id}",
                        maxlength: Comment.body_max_length,
                        rows: 4,
                        label: false,
                        placeholder: t("legislation.questions.comments.form.leave_comment_help_text") %>
      <% else %>
        <%= f.hidden_field :terms_of_service, value: 1 %>
        <%= f.hidden_field :subject, value: 1 %>

        <%= f.text_area :body, id: "comment-body-#{css_id}",
                               maxlength: Comment.body_max_length,
                               rows: 4,
                               label: leave_reply_text(commentable) %>
      <% end %>

      <%= f.hidden_field :commentable_type, value: commentable.class.name %>
      <%= f.hidden_field :commentable_id, value: commentable.id %>
      <%= f.hidden_field :parent_id, value: parent_id %>
      <%= f.hidden_field :valuation, value: valuation %>

      <%= f.submit comment_button_text(parent_id, commentable), class: "button", id: "publish_comment" %>

      <% if commentable.class != Legislation::Question %>
        <% if can? :comment_as_moderator, commentable %>
          <div class="float-right">
            <%= f.check_box :as_moderator,
              label: t("comments.form.comment_as_moderator"),
              id: "comment-as-moderator-#{css_id}" %>
          </div>
        <% end %>
        <% if can? :comment_as_administrator, commentable %>
          <div class="float-right">
            <%= f.check_box :as_administrator,
              label: t("comments.form.comment_as_admin"),
              id: "comment-as-administrator-#{css_id}" %>
          </div>
        <% end %>
      <% end %>

    <% end %>
  </div>
<% end %>
